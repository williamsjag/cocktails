{% extends "layout.html" %}

{% block title %}
    Add Cocktail
{% endblock %}

{% block main %}
    <!-- Add cocktail form -->
    <form action="/addcocktail" class="center" method="post">
            <!-- name field -->
        <div class="form-group mb-3">
            <label for="name" class="form-label">Ingredient Name</label>
            <input autocomplete="off" autofocus class="form-control" id="name" name="name" placeholder="Name" type="text">
        </div>
            <!--ingredients menu -->
        <div class="mb-3 form-group">
            <label for="ingredient" class="form-label">Intredients</label>
            <ol name="ingredients" id="dynamicSelects">
                <!-- initial select menu -->
                <li class="select" id="ingredientmenu">
                    <select name="ingredient" class="selectlink custom-select mb-3 form-select">
                        <option value="" disabled selected>--Ingredient--</option>
                        <option value="addingredient" href="/addingredient">--Create New Ingredient--</option>
                        {% for type in types %}
                        <optgroup label="{{ type.type|capitalize }}">
                            {% for ingredient in ingredients %}
                                {% if ingredient.type == type.type %}
                                <option value="{{ ingredient.name }}">{{ingredient.name|title }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        {% endfor %}
                    </select>
                </li>
            </ol>
        </div>
        
        <!-- More ingredients button -->
        <div class="mb-3">
            <button class="btn btn-primary btn-sm" id="more_ingredients" type="button" onclick="createNewDiv()">More Ingredients</button>
        </div>
        <!-- Build instructions field -->
        <div class="form-group mb-3">
            <label for="build" class="form-label">Build Instructions</label>
            <textarea autocomplete="off" class="form-control" id="build" name="build" placeholder="Build Instructions/Garnish/Notes" rows="4"></textarea>
        </div>
        <!-- Source field -->
        <div class="form-group mb-3">
            <label for="source" class="form-label">Source</label>
            <input autocomplete="off" class="form-control" id="source" name="source" placeholder="Source" type="text">
        </div>
        <!-- family field -->
        <div class="mb-3 form-group">
            <label for="family" class="form-label">Cocktail Family</label>
            <select name="family" class="form-select" id="family">
                <option value="" disabled selected>--Family--</option>
                <option value="oldfashioned">Old Fashioneds</option>
                <option value="sour">Sours</option>
                <option value="vermouth">Vermouth Cocktails</option>
                <option value="amaro">Amaro Cocktails</option>
                <option value="duotrio">Duos and Trios</option>
                <option value="champagne">Champagne Cocktails</option>
                <option value="highball">Highballs</option>
                <option value="julep">Juleps and Smashes</option>
                <option value="hot">Hot Drinks</option>
                <option value="egg">Flips and Nogs</option>
                <option value="tiki">Tiki Cocktails</option>
                <option value="punch">Punches</option>
                <option value="orphans">Orphans</option>
            </select>
        </div>
        <button class="btn btn-primary btn-lg" type="submit">Add Cocktail</button>
    </form>
    <!-- Modal for adding ingredient -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content" id="modalform">
          <span class="close">&times;</span>
          <form action="/ingredientmodal" id="addItemForm" method="post">
            <div class="form-group mb-3">
                <label for="ingredientname" class="form-label">Ingredient Name</label>
                <input autocomplete="off" autofocus class="form-control" id="ingredientname" name="ingredientname" placeholder="Name" type="text">
            </div>
            <div class="mb-3 form-group">
                <label for="type" class="form-label">Ingredient Type</label>
                <select name="type" id="type" class="form-select">
                    <option value="" disabled selected>--Ingredient Type--</option>
                    <option value="spirit">Spirit</option>
                    <option value="liqueur">Liqueur</option>
                    <option value="wine">Wine/Vermouth/Sherry</option>
                    <option value="bitters">Bitters</option>
                    <option value="syrup">Syrup</option>
                    <option value="juice">Juice</option>
                    <option value="pantry">Pantry/Fridge</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <br>
            <div class="mb-3">
                <label for="stock">In Stock:</label>
                <input id="stock" name="stock" type="checkbox">
            </div>
            <button onclick="alertName(event)" id="modalbutton" class="btn btn-primary" type="submit">Add Ingredient</button>
        </form>
        </div>
      
      </div>
      
{% endblock %}
{% block javascript %}
<script>
    // Add modal for new ingredient
    var modal = document.getElementById("myModal");
    var span = document.getElementsByClassName("close")[0];
    // pull up modal when add new ingredient is selected
    document.querySelector('.selectlink').onchange = function() {
        var val = this.children[this.selectedIndex].getAttribute('href');
        if (val[0] === "/") {
            modal.style.display = "block";
        }
    }
    span.onclick = function() {
        modal.style.display = "none";
    }
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    $(window).on('hidden.bs.modal', function() { 
        $('#code').modal('hide');
        alert('hidden');
    });
    // create new select fields on button press
   
    function createNewDiv() {
        // get original select field
        var originalElement = document.getElementById('ingredientmenu');

        // create a new one
        var newDiv = document.createElement('li');

        // copy original population into new
        newDiv.innerHTML = originalElement.innerHTML;

        // newDiv.classList.add('mb-3', 'select')

        // add new div to dynamicSelects
        var hostdiv = document.getElementById('dynamicSelects');
        hostdiv.appendChild(newDiv);



        // add event listener to listen for link
        var newSelect = newDiv.querySelector('.selectlink');
        newSelect.onchange = function() {
            var val = this.children[this.selectedIndex].getAttribute('href');
            if (val[0] === "/") {
                modal.style.display = "block";
            }
        }
    }

    // focus on new element when more ingredients is clicked
    document.getElementById('more_ingredients').addEventListener('click', function () {
        // select the list items
        document.find('.select:last').focus();
    });
</script>
{% endblock %}
